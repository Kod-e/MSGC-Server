# MSGC协议设计

## 用户信息服务器

### 用户注册和身份验证
- 用户在注册时生成一对公私钥对。
- 用户的公钥和用户名等信息存储在用户信息服务器上。
- 用户信息服务器之间通过P2P网络进行同步，确保所有服务器上的用户信息一致。
- 使用区块链技术记录用户的注册信息，确保数据的不可篡改性和可追溯性。

### 添加好友
- 用户通过用户名搜索好友，用户信息服务器返回对应的公钥。
- 用户发送好友请求，使用自己的私钥对请求进行签名，并生成一个AES密钥。
- 用户在好友请求中包含加密后的AES密钥，接收方使用发送方的公钥解密AES密钥。

## 消息服务器

### 消息传递
- 每个用户指定一个消息服务器来存储和转发消息，消息服务器和用户信息服务器是完全分开的，并且最好由不同的运营者运营。
- 消息在发送前使用AES密钥进行加密，确保只有接收方能够解密和读取消息。
- 消息服务器存储以下信息：
  - 用户之间的唯一标识符，格式一般为AES后的 `A用户名_B用户名`
  - 消息的内容（加密后的）。
  - 发送的时间。
- 消息服务器之间不进行广播，确保消息的隐私性。

## 隐私保护

### 区块链
- 使用区块链技术记录用户的注册信息，确保数据的不可篡改性和可追溯性。
- 每个区块包含一组用户注册信息，区块链网络中的所有节点共同维护这条链。

### 隐私保护
- 所有的消息内容在传输和存储过程中都进行加密，只有发送方和接收方能够解密。
- 用户的私钥仅存储在用户本地设备上，不会上传到服务器，确保私钥的安全性。

### P2P网络
- 用户信息服务器之间通过P2P网络进行通信，确保系统的去中心化和高可用性。
- 使用分布式哈希表（DHT）等技术来实现P2P网络中的节点查找和数据存储。